# 超采样功能验证指南

本文档介绍如何验证 OGScope 的超采样设置是否有效，确保后续开发中获取的视频流是经过超采样的高质量视频流。

## 超采样功能概述

超采样（Supersample）是一种图像质量提升技术，通过以高于输出分辨率的分辨率捕获图像，然后使用软件降采样算法（如 INTER_AREA）将图像缩放到目标分辨率。这种方法可以：

1. **提高图像质量**：减少锯齿和噪声
2. **增强细节表现**：保留更多图像细节
3. **改善色彩过渡**：使色彩过渡更加平滑

## 验证方法

### 1. API 端点验证

我们提供了两个专门的 API 端点来验证超采样设置：

#### 验证超采样设置
```bash
GET /debug/camera/verify-supersample
```

此端点返回详细的超采样配置信息，包括：
- 采样模式状态
- 捕获分辨率和输出分辨率
- 超采样比例
- 质量评估
- 优化建议

#### 测试图像尺寸
```bash
POST /debug/camera/test-image-size
```

此端点捕获一张实际图像并验证：
- 实际图像尺寸是否与预期输出尺寸匹配
- 超采样功能是否正常工作

### 2. 使用测试脚本

运行完整的超采样验证测试：

```bash
# 完整测试（包括直接相机类测试）
python scripts/test_supersample.py

# 仅 API 测试（适用于远程测试）
python scripts/test_supersample.py --api-only [服务器地址]
```

测试脚本会：
1. 验证相机类的超采样配置
2. 测试 API 端点功能
3. 在不同分辨率下测试超采样效果
4. 生成详细的测试报告

### 3. 日志监控

相机驱动会在日志中记录详细的超采样信息：

```
[INFO] 采样模式从 native 切换到: supersample
[INFO] 超采样模式激活:
[INFO]   - 捕获分辨率: 1280x720
[INFO]   - 输出分辨率: 640x360
[INFO]   - 超采样比例: 2.00x
[INFO]   - 超采样质量: 优秀
[DEBUG] 超采样降采样: 1280x720 -> 640x360
```

## 验证标准

### 超采样比例评估

| 比例范围 | 质量等级 | 说明 |
|---------|---------|------|
| ≥ 1.5x | 优秀 | 显著的图像质量提升 |
| ≥ 1.2x | 良好 | 明显的图像质量改善 |
| > 1.0x | 中等 | 有限的图像质量提升 |
| = 1.0x | 无效 | 无超采样效果 |

### 验证成功的条件

1. **采样模式**：设置为 `supersample`
2. **分辨率关系**：捕获分辨率 > 输出分辨率
3. **超采样比例**：≥ 1.2x（推荐 ≥ 1.5x）
4. **图像尺寸匹配**：实际捕获图像尺寸 = 输出分辨率
5. **功能正常**：能够正常进行降采样处理

## 配置建议

### 推荐配置

```json
{
  "camera": {
    "width": 640,
    "height": 360,
    "sampling_mode": "supersample"
  }
}
```

对应的捕获分辨率会自动设置为更高的分辨率（如 1280x720），实现 2.0x 的超采样。

### 性能考虑

- **高比例超采样**（> 3.0x）：可能影响性能，建议适当降低
- **低比例超采样**（< 1.2x）：图像质量提升有限
- **推荐范围**：1.5x - 2.5x

## 故障排除

### 常见问题

1. **超采样未激活**
   - 检查 `sampling_mode` 是否设置为 `supersample`
   - 验证相机是否正确初始化

2. **分辨率不匹配**
   - 检查捕获分辨率和输出分辨率的配置
   - 确保捕获分辨率高于输出分辨率

3. **图像尺寸错误**
   - 检查降采样算法是否正常工作
   - 验证 OpenCV 库是否正确安装

### 调试步骤

1. 运行验证脚本检查基本配置
2. 查看日志文件确认超采样状态
3. 使用 API 端点验证实时状态
4. 测试不同分辨率下的表现

## 开发集成

在后续开发中，确保：

1. **使用正确的相机实例**：通过 `get_camera_instance()` 获取
2. **检查超采样状态**：调用 `get_camera_info()` 验证配置
3. **监控日志输出**：关注超采样相关的日志信息
4. **定期验证**：使用测试脚本定期检查功能状态

## 总结

通过以上验证方法，你可以确保 OGScope 的超采样功能正常工作，后续开发中获取的视频流将具有更高的图像质量。建议在每次部署后运行验证测试，确保超采样功能按预期工作。
